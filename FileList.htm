<!DOCTYPE html>
<html lang="ru">
<script src="./scripts/jquery.min.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">file list</title>
</head>

<body>
    <div id="base">
        <div id="label1">
            <div id="label2">DygDyg MC: ver </div>
        </div>
        <div id="table"></div>
    </div>
</body>
<style>
    @font-face {
        font-family: clacon2;
        src: url('./fonts/clacon2.woff2') format("woff2"),
            url('./fonts/clacon2.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    :root {
        cursor: url('./cursor.png'), auto;
        background-color: #000075;
        font-family: "clacon2", "Arial", sans-serif;
        color: #6fcbcb;
        user-select: none;
        width: 99%;
        height: 99%;
    }

    body {
        width: 99%;
        height: 99%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .switch-label {
        /* display: none !important; */
        visibility: hidden;
    }

    /* body {

    } */
    #base {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        align-items: center;
    }



    #table {
        display: flex;
        flex-wrap: nowrap;
        flex-direction: row;
    }

    #label1 {
        display: flex;
        flex-wrap: nowrap;
        flex-direction: row;
    }

    #label2 {
        background-color: #009797;
        color: #00076b;
        padding: 2px;
    }

    .list {
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        align-items: stretch;
        width: 128px;
        border: solid;
    }

    .button {
        /* display: table; */
        padding: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;

    }

    .button:hover {
        color: #00076b;
        background-color: #009797;
    }

    .directory {
        color: #b9cdcd;
    }

    .void {
        height: 17px;
    }
</style>
<script>
    var ver = "0.0.3"
    var name_ = "DygDyg MC"
    $("#label2").text(name_ + ": ver " + ver)
    $('title').text(name_ + ": ver " + ver)
    var database = {}
    var line = null
    var column = 0
    var adres = []
    var col_num = 0

    function sort1(o1, o2) {
        return o1.type.localeCompare(o2.type)
    }

    // $.get('./DataList.json', function (data) {
    //     database = data.children
    //     // select_button(database)
    //     // console.log(database)
    // });

    $.ajax({
        url: './DataList.json',
        dataType: 'text',
        success: function (data) {
            var jsonData = jQuery.parseJSON($('<div />').html(data).text());
            database = jsonData.children
            select_button(database)
        },
        error: function () {
            console.log('Error occurred while fetching data.');
        },
        beforeSend: function (xhr) {
            xhr.overrideMimeType("text/plain; charset=windows-1251")
        }
    });



    function select_button(database) {
        remove_button()
        col_num = 0
        database.sort(sort1).forEach(function (e, i, a) {

            add_button(e, i, a)
        });

        for (let i = col_num; i < 80; i++) {
            add_void()
        }
    }
    function remove_button(e, i, a) {
        $("#table").empty();
        line = null
        column = 0
    }

    function back_button() {
        dat = {}
        adres.pop()
        if (adres.length > 0) {
            select_button(adres[adres.length - 1])
        } else {
            $('title').text(name_ + ": ver " + ver)
            select_button(database)
        }
    }

    function add_void() {
        if (line == 0 || line == null) $('#table').append(`<div id="list${column}"class="list"></div>`)
        if (line == null) {
            if (adres.length > 0) $('#list' + column).append(`<div id='button' class='button'>..</div>`)
            $(`#button`).on("click", function () { back_button() })
        }
        if (line < 20) {
            line++
        } else {
            line = 0
            column++
        }
        $('#list' + column).append(`<div id='void' class='void'></div>`)
    }

    function add_button(e, i, a) {


        if (e.name.startsWith(".")) return
        if (line == 0 || line == null) $('#table').append(`<div id="list${column}"class="list"></div>`)
        if (line == null) {
            if (adres.length > 0) $('#list' + column).append(`<div id='button' class='button'>..</div>`)
            $(`#button`).on("click", function () { back_button() })
        }
        if (line < 20) {
            line++
        } else {
            line = 0
            column++
        }
        col_num++

        $('#list' + column).append(`<div id='button${i}' class='button ${e.type}'>${e.name}</div>`)
        if (e.type == "file") {

        } else {
            $(`#button${i}`).on("click", function () {
                $('title').text(name_ + ": " + a[i].name)
                adres.push(a[i].children)
                select_button(a[i].children)
            })
        }
        $(`#button${i}`).on("click", function () {
        })

    }
</script>

</html>